<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SETTINGS - NOTHING Hub</title>
    
    <script>
        // --- START: CLOAK & THEME SETUP ---
        
        // 1. Theme Loading
        const savedTheme = localStorage.getItem('hubTheme');
        const currentTheme = savedTheme ? savedTheme : 'rainbow';
        document.documentElement.className = `theme-${currentTheme}`;

        // 2. Static Cloak Loading
        const savedFavicon = localStorage.getItem('hubFavicon');
        const savedTitle = localStorage.getItem('hubTitle');
        const defaultTitle = 'NOTHING - Single Page Game Hub';
        
        const faviconUrl = savedFavicon 
            ? savedFavicon 
            : "data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üêª</text></svg>";
        
        const ORIGINAL_TITLE = savedTitle ? savedTitle : defaultTitle;
        document.title = ORIGINAL_TITLE;
        
        let link = document.querySelector("link[rel~='icon']");
        if (!link) {
            link = document.createElement('link');
            link.rel = 'icon';
            document.getElementsByTagName('head')[0].appendChild(link);
        }
        link.href = faviconUrl;
        
        // 3. Panic Hide function (Redirects to a neutral external site)
        function panicHide() {
            window.location.replace("https://www.wikipedia.org/");
        }

        // 4. About:Blank Cloak function
        function openAboutBlank() {
            const currentUrl = window.location.href;
            const blank = window.open('about:blank', '_blank');
            if (blank) {
                blank.document.write(`
                    <!DOCTYPE html>
                    <html>
                    <head>
                        <title>${document.title}</title>
                        <style>
                            body { margin: 0; overflow: hidden; }
                            iframe { border: none; width: 100vw; height: 100vh; }
                        </style>
                    </head>
                    <body>
                        <iframe src="${currentUrl}"></iframe>
                    </body>
                    </html>
                `);
                blank.document.close();
            }
        }

        // --- END: CLOAK & THEME SETUP ---

        // --- START: SETTINGS LOGIC ---
        
        document.addEventListener('DOMContentLoaded', () => {
            const themeSelector = document.getElementById('theme-selector');
            const titleInput = document.getElementById('title-input');
            const faviconInput = document.getElementById('favicon-input');
            const notificationToggle = document.getElementById('notification-cloak-toggle');
            const loaderMessageInput = document.getElementById('loader-message-input'); // New Element
            
            // --- CONSTANTS ---
            const CLOAKED_TITLE = '(1) Message Student/Portal';
            const defaultLoaderMessage = 'Loading...';

            // Load saved settings on page load
            themeSelector.value = localStorage.getItem('hubTheme') || 'rainbow';
            titleInput.value = localStorage.getItem('hubTitle') || defaultTitle;
            faviconInput.value = localStorage.getItem('hubFavicon') || '';
            notificationToggle.checked = localStorage.getItem('notificationCloakEnabled') === 'true';
            loaderMessageInput.value = localStorage.getItem('hubLoaderMessage') || ''; // Load New Setting

            // Save Theme setting
            themeSelector.addEventListener('change', (e) => {
                localStorage.setItem('hubTheme', e.target.value);
                document.documentElement.className = `theme-${e.target.value}`;
            });

            // Save Title setting
            titleInput.addEventListener('input', (e) => {
                const newTitle = e.target.value.trim() || defaultTitle;
                localStorage.setItem('hubTitle', newTitle);
                if (!notificationToggle.checked) {
                    document.title = newTitle; 
                }
            });
            
            // Save Favicon setting
            faviconInput.addEventListener('input', (e) => {
                const newFavicon = e.target.value.trim();
                localStorage.setItem('hubFavicon', newFavicon);
                
                let favLink = document.querySelector("link[rel~='icon']");
                if (favLink) {
                   favLink.href = newFavicon || "data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üêª</text></svg>";
                }
            });
            
            // Save Loader Message setting (NEW)
            loaderMessageInput.addEventListener('input', (e) => {
                const newMessage = e.target.value.trim() || '';
                localStorage.setItem('hubLoaderMessage', newMessage);
            });


            // Notification Cloak Logic
            notificationToggle.addEventListener('change', (e) => {
                localStorage.setItem('notificationCloakEnabled', e.target.checked);
                
                if (e.target.checked) {
                    document.title = CLOAKED_TITLE;
                    alert('Notification Cloak is now Enabled. Look at the tab title!');
                } else {
                    document.title = ORIGINAL_TITLE; 
                    alert('Notification Cloak is now Disabled. Tab title reverted.');
                }
            });
        });

        // --- END: SETTINGS LOGIC ---
    </script>

    <style>
        /* CSS Keyframes for the Never-Ending Rainbow Background */
        @keyframes rainbow-glow {
            0% { background-color: #ff0000; } 16% { background-color: #ff7f00; } 
            33% { background-color: #ffff00; } 50% { background-color: #00ff00; } 
            66% { background-color: #0000ff; } 83% { background-color: #4b0082; } 
            100% { background-color: #ff0000; } 
        }
        
        /* Variables for Solid Colors */
        :root {
            --dark-bg: #1a1a1a;
            --blue-bg: #007bff;
            --purple-bg: #6f42c1;
            --main-text: #fff;
            --accent-color: #ff5722;
        }

        /* --- FIXES FOR SCROLLING & THEMES --- */
        html { height: 100%; }
        
        body {
            font-family: sans-serif;
            margin: 0;
            color: var(--main-text);
            min-height: 100%; 
            background-color: var(--dark-bg); 
            background-repeat: no-repeat;
            background-attachment: fixed; 
        }

        /* THEME CLASSES */
        .theme-rainbow body {
            background-color: #1a1a1a;
            animation: rainbow-glow 10s infinite linear; 
        }
        .theme-dark body { background-color: var(--dark-bg); animation: none; }
        .theme-blue body { background-color: var(--blue-bg); animation: none; }
        .theme-purple body { background-color: var(--purple-bg); animation: none; }

        /* --- Layout & Component Styles --- */
        header {
            padding: 30px 20px 20px; 
            background-color: rgba(44, 44, 44, 0.9); 
            text-align: center;
            backdrop-filter: blur(5px); 
            position: relative; 
        }
        
        .utility-buttons {
            position: absolute;
            top: 10px;
            width: 95%; 
            display: flex;
            justify-content: space-between;
            padding: 0 10px;
        }

        .utility-buttons div {
            display: flex;
        }
        
        .utility-buttons a {
            text-decoration: none;
            color: #fff;
            background-color: #555;
            padding: 8px 15px;
            border-radius: 5px;
            font-weight: bold;
            transition: background-color 0.2s;
            margin-left: 10px;
        }

        .utility-buttons a:first-child { 
            margin-left: 0;
        }

        .utility-buttons a:hover { background-color: var(--accent-color); }

        h1 { margin: 0; color: var(--accent-color); }
        h2 { color: var(--accent-color); border-bottom: 1px solid #444; padding-bottom: 10px }
        
        main {
            padding: 30px;
            max-width: 800px;
            margin: 30px auto;
            background-color: rgba(26, 26, 26, 0.9); 
            border-radius: 10px;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.5); 
        }

        /* Settings Form Styles */
        .setting-group {
            margin-bottom: 25px;
            padding: 15px;
            border: 1px solid #444;
            border-radius: 6px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: var(--accent-color);
        }

        input[type="text"], select {
            width: 100%;
            padding: 10px;
            margin-top: 5px;
            box-sizing: border-box;
            background-color: #333;
            border: 1px solid #555;
            color: var(--main-text);
            border-radius: 4px;
        }

        .toggle-container {
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        /* Panic Button fixed to corner */
        .panic-btn-fixed {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background-color: #a80000;
            color: #fff;
            padding: 10px 15px;
            border: 2px solid #ff0000;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            z-index: 1000;
            transition: background-color 0.3s;
        }
        .panic-btn-fixed:hover {
            background-color: #ff0000;
            box-shadow: 0 0 15px #ff0000;
        }
    </style>
</head>
<body>
    <header>
        <div class="utility-buttons">
            <a href="javascript:void(0)" onclick="openAboutBlank()">üîí OPEN IN BLANK</a>

            <div>
                <a href="index.html">üè† HOME</a>
                <a href="bookmarklets.html">üìö BOOKMARKLETS</a>
            </div>
        </div>
        <h1>SETTINGS</h1>
        <p>Customize your hub's appearance and stealth features.</p>
    </header>
    <main>
        <h2>Theme & Appearance</h2>

        <div class="setting-group">
            <label for="theme-selector">Select Background Theme:</label>
            <select id="theme-selector">
                <option value="rainbow">Rainbow Glow (Default)</option>
                <option value="dark">Dark Mode</option>
                <option value="blue">Deep Blue</option>
                <option value="purple">Vibrant Purple</option>
            </select>
        </div>

        <h2>Cloaking & Stealth</h2>

        <div class="setting-group">
            <label for="title-input">Set Custom Page Title (Static Cloak):</label>
            <input type="text" id="title-input" placeholder="e.g., Google Drive, Math Homework">
            <small style="color: #ccc;">Leave blank to use default.</small>
        </div>
        
        <div class="setting-group">
            <label for="favicon-input">Set Custom Favicon URL (Emoji or Image URL):</label>
            <input type="text" id="favicon-input" placeholder="e.g., üìù or https://example.com/favicon.png">
            <small style="color: #ccc;">Paste an emoji or a full image URL. Leave blank for default (üêª).</small>
        </div>

        <div class="setting-group toggle-container">
            <label for="notification-cloak-toggle" style="margin-bottom: 0;">
                Active Cloak (Title Switch on Blur)
                <small style="display: block; font-weight: normal; color: #aaa;">Changes title to '(1) Message Student/Portal' when you switch tabs.</small>
            </label>
            <input type="checkbox" id="notification-cloak-toggle" style="width: auto;">
        </div>
        
        <h2 style="margin-top: 50px;">User Experience & Fun</h2>

        <div class="setting-group">
            <label for="loader-message-input">Set Custom Loading Message:</label>
            <input type="text" id="loader-message-input" placeholder="e.g., Loading Fun..., Welcome Back!">
            <small style="color: #ccc;">This message appears briefly when the page loads.</small>
        </div>
    </main>
    <footer>
        <p>¬© 2025 NOTHING Gaming</p>
    </footer>
    
    <button class="panic-btn-fixed" onclick="panicHide()">üö® PANIC</button>
</body>
</html>
